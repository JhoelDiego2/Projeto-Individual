<!DOCTYPE html>
<html lang="pt">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Shadow Slave | Login</title>
  <script src="./js/sessao.js"></script>
  <link rel="stylesheet" href="css/login-cadastro.css">
</head>

<body>
  <main id="main">
    <div class="imagem_fundo" id="imagem_de_fundo"></div>
    <!--FORMULARIO DE LOGIN_________________________________________________________-->
    <div class="cadastro-login">
      <div class="column-login" id="container_login">
        <div class="card-login" id="provando">
          <p id="titulo">Iniciar Sessão</p>
          <p id="subtitulo">Não possui uma conta?<span onclick="trocar_cadastro()"
              style="color: grey; text-decoration: underline; ">Acesse aqui</span></p>
          <div><img src="assets/svg/user.svg" alt="">
            <p id="texto_nome_usuario">Nome de usúario</p>
          </div>
          <input type="text" id="ipt_nome_usuario" onclick="digitando_login('nome_usuario')" >
          <div><img src="assets/svg/lock-closed.svg" alt="">
            <p id="texto_senha">Senha</p>
          </div>
          <input type="password" id="ipt_senha" onclick="digitando_login('senha')" >
          <button onclick="verificar()">ENTRAR</button>
          <p id="subtitulo">Esqueceu a senha?<span><a onclick="activar_esqueci()"
                style="color: grey; text-decoration: underline;">Acesse aqui</a></span></p>
        </div>
      </div>
      <div class="column-cadastro">
        <!--_____________________________________________________FORMULARIO DE CADASTRO____-->
        <div class="card-login">
          <p id="titulo">Cadastro</p>
          <div>
            <img src="assets/svg/user.svg" alt="">
            <p id="texto_nome_usuario_cad">Nome de usúario</p>
          </div>
          <input type="text" id="ipt_nome_usuario_cad" onclick="digitando_cad('nome_usuario_cad')" >
          <div>
            <img src="assets/svg/mail.svg" alt="">
            <p id="texto_email">Email</p>
          </div>
          <span id="email_condicao"></span>
          <input type="text" id="ipt_email" onclick="digitando_cad('email')" >
          <div>
            <img src="assets/svg/lock-closed.svg" alt="">
            <p id="texto_senha_cad">Senha</p>
          </div>
          <input type="password" id="ipt_senha_cad" onclick="digitando_cad('senha_cad')">
          <div>
            <img src="assets/svg/lock-closed.svg" alt="">
            <p id="texto_conf_senha">Confirmar Senha</p>
          </div>
          <input type="password" id="ipt_conf_senha" onclick="digitando_cad('conf_senha')" >
          <button onclick="cadastrar()">CADASTRAR-SE</button >
          <p id="subtitulo">Já possui uma conta?<span onclick="trocar_login()"
              style="color: #658a87; text-decoration: underline;">Acesse aqui</span></p>
        </div>
      </div>
    </div>
    </div>
  </main>
  <div class="esqueci_senha" id="cartao_esqueci_senha" style="display: none;">
    <div class="imagem_logo">

    </div>
    <p>Esqueceu a senha?</p>
    <p>Iremos te ajudar a recuperar a sua conta</p>
    <p id="placeholder"> <img src="assets/img/github.png" alt="">Porfavor Informe o seu email</p>
    <input type="email" onclick="esqueci()" id="ipt_esqueci_senha">
  </div>
  <div id="div_alerta" style="display: none;">
    <img src="assets/img/sunny_chibi.png" alt="" id="sunny_chibi">
    <p id="titulo_erro">
      Senha incorreta
    </p>
    <p id="mensagem_erro">
      Se nem sua própria senha te reconhece… quem é você, afinal?
    </p>
    <button onclick="tirar_alerta()" id="bottom_mensagem">OK</button>
  </div>
  <div id="div_cad_sucesso"  style="display: none;">
    <img src="assets/img/sunny_feliz.png" alt="" id="sunny_cad">
    <p id="titulo_cad">
        Cadastro realizado com sucesso
    </p>
    <p id="mensagem_cad">
        Sunny sorri nas trevas — o pacto está feito e o ouro já brilha no seu destino!
    </p>
    <p   id="bottom_mensagem_cad" onclick="trocar_login_alerta()">FAZER LOGIN</p>
</div>
  <script src="js/login-cadastro.js"></script>
</body>

</html>
<script>

  function esqueci() {
    placeholder.style = "color: #7aa7a4;top: 0vh;"
    ipt_esqueci_senha.style.borderBottom = "solid 4px #7aa7a4";


  }
  function activar_esqueci() {
    cartao_esqueci_senha.style = "display:1"
    main.style = "filter: blur(2.4px);  "
    provando.style = "display:none"

  }
  function verificar() {
    var usuario = ipt_nome_usuario.value
    var senha = ipt_senha.value
    var verificar = true

    while (verificar == true) {
      div_alerta.style = "display:1"
      main.style = "filter: blur(2.4px); "
      if (usuario == '' && senha == '') {
        titulo_erro.innerHTML = "Campos vazios"
        mensagem_erro.innerHTML = "Nem ao menos tentou. O vazio responde com silêncio."
        break
      }
      if (usuario == '') {
        titulo_erro.innerHTML = "Campo de usuário vazio"
        mensagem_erro.innerHTML = "Nem um nome? Até as sombras têm identidade."
        break
      }
      if (senha == '') {
        titulo_erro.innerHTML = "Campo de senha vazio"
        mensagem_erro.innerHTML = "Sem uma chave, não há porta que se abra. Nem mesmo as escondidas na escuridão."
        break
      }
      // voltar para colocar o certo
      if (senha == 'incorreta') {
        titulo_erro.innerHTML = " Senha incorreta"
        mensagem_erro.innerHTML = "Nem um nome? Até as sombras têm identidade."
        break
      }
      if (usuario == 'nao_existe') {
        titulo_erro.innerHTML = "Usuário não existe"
        mensagem_erro.innerHTML = "Procure onde você se perdeu. Porque aqui, você não está."
        break
      }
      titulo_erro.innerHTML = "Em desenvolvimento "
      mensagem_erro.innerHTML = "Procure onde você se perdeu. Porque aqui, você não está."
      verificar = false
      }
      if (verificar == false) {
        
        console.log("FORM LOGIN: ", usuario);
        console.log("FORM SENHA: ", senha);

        fetch("/usuarios/autenticar", {
            method: "POST",
            headers: {
                "Content-Type": "application/json"
            },
            body: JSON.stringify({
                nomeServer: usuario,
                senhaServer: senha
            })
        }).then(function (resposta) {
            console.log("ESTOU NO THEN DO entrar()!")

            if (resposta.ok) {
                console.log(resposta);

                resposta.json().then(json => {
                    console.log(json);
                    console.log(JSON.stringify(json));
                    sessionStorage.NOME_USUARIO = json.nome;
                    sessionStorage.ID_USUARIO = json.idUsuario;

                    setTimeout(function () {
                        window.location = "game.html";
                    }, 1000); // apenas para exibir o loading

                });

            } else {

                console.log("Houve um erro ao tentar realizar o login!");

                resposta.text().then(texto => {
                    console.error(texto);
                    finalizarAguardar(texto);
                });
            }

        }).catch(function (erro) {
            console.log(erro);
        })

        return false;
      }
    }
  
</script>